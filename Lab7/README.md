# Lab 7 — Architecture, Layers & DDD-lite

Учебный проект демонстрирует слоистую архитектуру (Domain / Application / Infrastructure) с применением DIP и упрощённого DDD-lite.
Реализован сценарий оплаты заказа через use-case с доменной моделью и инфраструктурными адаптерами без реальной БД.

## Architecture (Layers)

### Domain
Доменный слой содержит бизнес-модель и правила:
- **Order** — сущность (агрегат)
- **OrderLine** — строка заказа (часть агрегата)
- **Money** — value object для суммы и валюты
- **OrderStatus** — статус заказа (например: NEW, PAID)

**Инварианты домена:**
- нельзя оплатить пустой заказ
- нельзя оплатить заказ повторно
- после оплаты нельзя менять строки заказа
- итоговая сумма равна сумме строк заказа

Домен не зависит от внешних систем и инфраструктуры.

### Application
Слой приложений содержит use-case **PayOrderUseCase**:
1) загружает заказ через `OrderRepository.get_by_id(order_id)`
2) выполняет доменную операцию оплаты (изменяет состояние заказа согласно правилам)
3) вызывает платеж через `PaymentGateway.charge(order_id, money)`
4) сохраняет заказ через `OrderRepository.save(order)`
5) возвращает результат оплаты (например, payment_id / статус)

Application зависит от **абстракций** (интерфейсов), а не от конкретных реализаций.

### Infrastructure
Инфраструктурный слой содержит реализации интерфейсов:
- **InMemoryOrderRepository** — репозиторий в памяти для тестов и демо
- **FakePaymentGateway** — тестовый платежный шлюз без реальных списаний

Infrastructure подключается снаружи и не влияет на доменную логику.

### Tests
Тесты проверяют use-case и доменные правила **без базы данных**:
- успешную оплату корректного заказа
- ошибку при оплате пустого заказа
- ошибку при повторной оплате
- невозможность изменения заказа после оплаты
- корректный расчёт итоговой суммы

## Interfaces

### OrderRepository
- `get_by_id(order_id)`
- `save(order)`

### PaymentGateway
- `charge(order_id, money)`

## How to run tests

```bash
python -m pytest -q
